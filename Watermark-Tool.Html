<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watermark Tool - Protect Your Work</title>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --gray: #6c757d;
            --gray-light: #e9ecef;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .app-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .upload-section {
            flex: 1;
            min-width: 300px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .preview-section {
            flex: 2;
            min-width: 300px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }
        
        .controls-section {
            flex: 1;
            min-width: 300px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray-light);
            color: var(--primary);
        }
        
        .upload-area {
            border: 2px dashed var(--gray);
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        
        .upload-area:hover {
            border-color: var(--primary);
            background-color: rgba(67, 97, 238, 0.05);
        }
        
        .upload-area i {
            font-size: 48px;
            color: var(--gray);
            margin-bottom: 10px;
        }
        
        .upload-area p {
            margin-bottom: 15px;
            color: var(--gray);
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-secondary {
            background-color: var(--gray);
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-success:hover {
            background-color: #3aa8d0;
        }
        
        .preview-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--gray-light);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
            min-height: 300px;
        }
        
        #imagePreview {
            max-width: 100%;
            max-height: 100%;
            display: none;
        }
        
        .placeholder-text {
            color: var(--gray);
            text-align: center;
            padding: 20px;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--gray-light);
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .range-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .range-control input {
            flex: 1;
        }
        
        .range-value {
            min-width: 40px;
            text-align: center;
        }
        
        .color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .color-picker input {
            width: 50px;
            height: 40px;
            border: none;
            padding: 0;
            cursor: pointer;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group input {
            width: 18px;
            height: 18px;
        }
        
        .position-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 10px;
        }
        
        .position-btn {
            padding: 10px;
            background-color: var(--gray-light);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .position-btn.active {
            background-color: var(--primary);
            color: white;
        }
        
        .position-btn:hover:not(.active) {
            background-color: #dae0e5;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .action-buttons .btn {
            flex: 1;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid var(--gray-light);
        }
        
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .preview-section, .upload-section, .controls-section {
                width: 100%;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Watermark Tool</h1>
            <p class="subtitle">Add text or image watermarks to protect your work ‚Ä¢ Improve quality ‚Ä¢ Convert to HD</p>
        </header>
        
        <div class="app-container">
            <div class="upload-section">
                <h2 class="section-title">Upload Image</h2>
                <div class="upload-area" id="uploadArea">
                    <i>üìÅ</i>
                    <p>Drag & drop your image here or click to browse</p>
                    <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                    <button class="btn" id="browseBtn">Browse Files</button>
                </div>
                <div class="control-group">
                    <label class="control-label">Quality Enhancement</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="enhanceQuality" checked>
                        <label for="enhanceQuality">Enhance image quality</label>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">Output Quality</label>
                    <div class="range-control">
                        <input type="range" id="qualitySlider" min="1" max="100" value="90">
                        <span class="range-value" id="qualityValue">90%</span>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">HD Conversion</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="hdConversion" checked>
                        <label for="hdConversion">Convert to HD (if needed)</label>
                    </div>
                </div>
            </div>
            
            <div class="preview-section">
                <h2 class="section-title">Preview</h2>
                <div class="preview-container">
                    <img id="imagePreview" alt="Preview">
                    <div class="placeholder-text" id="previewPlaceholder">
                        Your image will appear here after upload
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-secondary" id="resetBtn">Reset</button>
                    <button class="btn btn-success" id="downloadBtn">Download Image</button>
                </div>
            </div>
            
            <div class="controls-section">
                <div class="tabs">
                    <div class="tab active" data-tab="text">Text Watermark</div>
                    <div class="tab" data-tab="image">Image Watermark</div>
                </div>
                
                <div class="tab-content active" id="textTab">
                    <div class="control-group">
                        <label class="control-label" for="watermarkText">Watermark Text</label>
                        <input type="text" id="watermarkText" class="form-control" placeholder="Enter your watermark text" value="Your Watermark">
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="textFont">Font Family</label>
                        <select id="textFont" class="form-control">
                            <option value="Arial, sans-serif">Arial</option>
                            <option value="'Times New Roman', serif">Times New Roman</option>
                            <option value="'Courier New', monospace">Courier New</option>
                            <option value="'Comic Sans MS', cursive">Comic Sans MS</option>
                            <option value="Impact, sans-serif">Impact</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="textSize">Font Size</label>
                        <div class="range-control">
                            <input type="range" id="textSize" min="10" max="100" value="30">
                            <span class="range-value" id="textSizeValue">30px</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Text Color</label>
                        <div class="color-picker">
                            <input type="color" id="textColor" value="#ffffff">
                            <span id="textColorValue">#FFFFFF</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Opacity</label>
                        <div class="range-control">
                            <input type="range" id="textOpacity" min="0" max="100" value="70">
                            <span class="range-value" id="textOpacityValue">70%</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Position</label>
                        <div class="position-controls">
                            <button class="position-btn" data-position="top-left">Top Left</button>
                            <button class="position-btn" data-position="top-center">Top Center</button>
                            <button class="position-btn" data-position="top-right">Top Right</button>
                            <button class="position-btn" data-position="center-left">Center Left</button>
                            <button class="position-btn" data-position="center">Center</button>
                            <button class="position-btn" data-position="center-right">Center Right</button>
                            <button class="position-btn" data-position="bottom-left">Bottom Left</button>
                            <button class="position-btn active" data-position="bottom-center">Bottom Center</button>
                            <button class="position-btn" data-position="bottom-right">Bottom Right</button>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="imageTab">
                    <div class="control-group">
                        <label class="control-label">Upload Watermark Image</label>
                        <div class="upload-area small" id="watermarkUploadArea">
                            <i>üñºÔ∏è</i>
                            <p>Click to upload watermark image</p>
                            <input type="file" id="watermarkImageUpload" accept="image/*" style="display: none;">
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Size</label>
                        <div class="range-control">
                            <input type="range" id="watermarkSize" min="5" max="50" value="20">
                            <span class="range-value" id="watermarkSizeValue">20%</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Opacity</label>
                        <div class="range-control">
                            <input type="range" id="watermarkOpacity" min="0" max="100" value="50">
                            <span class="range-value" id="watermarkOpacityValue">50%</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Position</label>
                        <div class="position-controls">
                            <button class="position-btn" data-position="top-left">Top Left</button>
                            <button class="position-btn" data-position="top-center">Top Center</button>
                            <button class="position-btn" data-position="top-right">Top Right</button>
                            <button class="position-btn" data-position="center-left">Center Left</button>
                            <button class="position-btn" data-position="center">Center</button>
                            <button class="position-btn" data-position="center-right">Center Right</button>
                            <button class="position-btn" data-position="bottom-left">Bottom Left</button>
                            <button class="position-btn active" data-position="bottom-center">Bottom Center</button>
                            <button class="position-btn" data-position="bottom-right">Bottom Right</button>
                        </div>
                    </div>
                </div>
                
                <div class="control-group">
                    <button class="btn" id="applyWatermarkBtn">Apply Watermark</button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Watermark Tool &copy; 2023 | Protect your creative work with professional watermarks</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const uploadArea = document.getElementById('uploadArea');
        const imageUpload = document.getElementById('imageUpload');
        const browseBtn = document.getElementById('browseBtn');
        const imagePreview = document.getElementById('imagePreview');
        const previewPlaceholder = document.getElementById('previewPlaceholder');
        const resetBtn = document.getElementById('resetBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const positionBtns = document.querySelectorAll('.position-btn');
        const applyWatermarkBtn = document.getElementById('applyWatermarkBtn');
        
        // Text watermark controls
        const watermarkText = document.getElementById('watermarkText');
        const textFont = document.getElementById('textFont');
        const textSize = document.getElementById('textSize');
        const textSizeValue = document.getElementById('textSizeValue');
        const textColor = document.getElementById('textColor');
        const textColorValue = document.getElementById('textColorValue');
        const textOpacity = document.getElementById('textOpacity');
        const textOpacityValue = document.getElementById('textOpacityValue');
        
        // Image watermark controls
        const watermarkUploadArea = document.getElementById('watermarkUploadArea');
        const watermarkImageUpload = document.getElementById('watermarkImageUpload');
        const watermarkSize = document.getElementById('watermarkSize');
        const watermarkSizeValue = document.getElementById('watermarkSizeValue');
        const watermarkOpacity = document.getElementById('watermarkOpacity');
        const watermarkOpacityValue = document.getElementById('watermarkOpacityValue');
        
        // Quality controls
        const enhanceQuality = document.getElementById('enhanceQuality');
        const qualitySlider = document.getElementById('qualitySlider');
        const qualityValue = document.getElementById('qualityValue');
        const hdConversion = document.getElementById('hdConversion');
        
        // State variables
        let originalImage = null;
        let currentImage = null;
        let watermarkImage = null;
        let activeTab = 'text';
        let textPosition = 'bottom-center';
        let imagePosition = 'bottom-center';
        
        // Event Listeners
        browseBtn.addEventListener('click', () => imageUpload.click());
        uploadArea.addEventListener('click', () => imageUpload.click());
        imageUpload.addEventListener('change', handleImageUpload);
        resetBtn.addEventListener('click', resetImage);
        downloadBtn.addEventListener('click', downloadImage);
        
        // Tab switching
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}Tab`).classList.add('active');
                activeTab = tab.dataset.tab;
            });
        });
        
        // Position buttons
        positionBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const parent = btn.closest('.position-controls');
                parent.querySelectorAll('.position-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                if (parent.closest('#textTab')) {
                    textPosition = btn.dataset.position;
                } else {
                    imagePosition = btn.dataset.position;
                }
            });
        });
        
        // Text controls
        textSize.addEventListener('input', () => {
            textSizeValue.textContent = `${textSize.value}px`;
        });
        
        textColor.addEventListener('input', () => {
            textColorValue.textContent = textColor.value.toUpperCase();
        });
        
        textOpacity.addEventListener('input', () => {
            textOpacityValue.textContent = `${textOpacity.value}%`;
        });
        
        // Image watermark controls
        watermarkUploadArea.addEventListener('click', () => watermarkImageUpload.click());
        watermarkImageUpload.addEventListener('change', handleWatermarkUpload);
        
        watermarkSize.addEventListener('input', () => {
            watermarkSizeValue.textContent = `${watermarkSize.value}%`;
        });
        
        watermarkOpacity.addEventListener('input', () => {
            watermarkOpacityValue.textContent = `${watermarkOpacity.value}%`;
        });
        
        // Quality controls
        qualitySlider.addEventListener('input', () => {
            qualityValue.textContent = `${qualitySlider.value}%`;
        });
        
        // Apply watermark
        applyWatermarkBtn.addEventListener('click', applyWatermark);
        
        // Functions
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                alert('Please select an image file.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(event) {
                originalImage = new Image();
                originalImage.onload = function() {
                    currentImage = originalImage;
                    displayImage(currentImage);
                    previewPlaceholder.style.display = 'none';
                    imagePreview.style.display = 'block';
                };
                originalImage.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function handleWatermarkUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                alert('Please select an image file.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(event) {
                watermarkImage = new Image();
                watermarkImage.onload = function() {
                    // Watermark image loaded successfully
                };
                watermarkImage.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function displayImage(img) {
            imagePreview.src = img.src;
        }
        
        function resetImage() {
            if (originalImage) {
                currentImage = originalImage;
                displayImage(currentImage);
            }
        }
        
        function applyWatermark() {
            if (!currentImage) {
                alert('Please upload an image first.');
                return;
            }
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas dimensions based on HD conversion setting
            let width = currentImage.width;
            let height = currentImage.height;
            
            if (hdConversion.checked) {
                // Increase dimensions for HD (limited to reasonable size)
                const maxDimension = 1920; // Max dimension for HD
                if (width > height && width < maxDimension) {
                    height = Math.round(height * (maxDimension / width));
                    width = maxDimension;
                } else if (height < maxDimension) {
                    width = Math.round(width * (maxDimension / height));
                    height = maxDimension;
                }
            }
            
            canvas.width = width;
            canvas.height = height;
            
            // Draw the original image
            ctx.drawImage(currentImage, 0, 0, width, height);
            
            // Apply quality enhancements if selected
            if (enhanceQuality.checked) {
                // Simple sharpening filter
                const imageData = ctx.getImageData(0, 0, width, height);
                const sharpenedData = sharpenImage(imageData, 0.5);
                ctx.putImageData(sharpenedData, 0, 0);
            }
            
            // Apply watermark based on active tab
            if (activeTab === 'text') {
                applyTextWatermark(ctx, width, height);
            } else {
                if (watermarkImage) {
                    applyImageWatermark(ctx, width, height);
                } else {
                    alert('Please upload a watermark image first.');
                    return;
                }
            }
            
            // Update the preview with the watermarked image
            const watermarkedImage = new Image();
            watermarkedImage.onload = function() {
                currentImage = watermarkedImage;
                displayImage(currentImage);
            };
            watermarkedImage.src = canvas.toDataURL('image/jpeg', qualitySlider.value / 100);
        }
        
        function applyTextWatermark(ctx, width, height) {
            const text = watermarkText.value || 'Your Watermark';
            const fontSize = parseInt(textSize.value);
            const fontFamily = textFont.value;
            const color = textColor.value;
            const opacity = parseInt(textOpacity.value) / 100;
            
            ctx.font = `bold ${fontSize}px ${fontFamily}`;
            ctx.fillStyle = color;
            ctx.globalAlpha = opacity;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // Calculate position
            const padding = 20;
            let x, y;
            
            switch (textPosition) {
                case 'top-left':
                    x = padding + ctx.measureText(text).width / 2;
                    y = padding + fontSize / 2;
                    ctx.textAlign = 'left';
                    break;
                case 'top-center':
                    x = width / 2;
                    y = padding + fontSize / 2;
                    break;
                case 'top-right':
                    x = width - padding - ctx.measureText(text).width / 2;
                    y = padding + fontSize / 2;
                    ctx.textAlign = 'right';
                    break;
                case 'center-left':
                    x = padding + ctx.measureText(text).width / 2;
                    y = height / 2;
                    ctx.textAlign = 'left';
                    break;
                case 'center':
                    x = width / 2;
                    y = height / 2;
                    break;
                case 'center-right':
                    x = width - padding - ctx.measureText(text).width / 2;
                    y = height / 2;
                    ctx.textAlign = 'right';
                    break;
                case 'bottom-left':
                    x = padding + ctx.measureText(text).width / 2;
                    y = height - padding - fontSize / 2;
                    ctx.textAlign = 'left';
                    break;
                case 'bottom-center':
                    x = width / 2;
                    y = height - padding - fontSize / 2;
                    break;
                case 'bottom-right':
                    x = width - padding - ctx.measureText(text).width / 2;
                    y = height - padding - fontSize / 2;
                    ctx.textAlign = 'right';
                    break;
            }
            
            // Add text shadow for better visibility
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 3;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;
            
            ctx.fillText(text, x, y);
            
            // Reset shadow and alpha
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
            ctx.globalAlpha = 1;
        }
        
        function applyImageWatermark(ctx, width, height) {
            const sizePercent = parseInt(watermarkSize.value) / 100;
            const opacity = parseInt(watermarkOpacity.value) / 100;
            
            // Calculate watermark dimensions
            const watermarkWidth = width * sizePercent;
            const watermarkHeight = (watermarkImage.height / watermarkImage.width) * watermarkWidth;
            
            // Calculate position
            const padding = 20;
            let x, y;
            
            switch (imagePosition) {
                case 'top-left':
                    x = padding;
                    y = padding;
                    break;
                case 'top-center':
                    x = (width - watermarkWidth) / 2;
                    y = padding;
                    break;
                case 'top-right':
                    x = width - watermarkWidth - padding;
                    y = padding;
                    break;
                case 'center-left':
                    x = padding;
                    y = (height - watermarkHeight) / 2;
                    break;
                case 'center':
                    x = (width - watermarkWidth) / 2;
                    y = (height - watermarkHeight) / 2;
                    break;
                case 'center-right':
                    x = width - watermarkWidth - padding;
                    y = (height - watermarkHeight) / 2;
                    break;
                case 'bottom-left':
                    x = padding;
                    y = height - watermarkHeight - padding;
                    break;
                case 'bottom-center':
                    x = (width - watermarkWidth) / 2;
                    y = height - watermarkHeight - padding;
                    break;
                case 'bottom-right':
                    x = width - watermarkWidth - padding;
                    y = height - watermarkHeight - padding;
                    break;
            }
            
            // Apply opacity and draw watermark
            ctx.globalAlpha = opacity;
            ctx.drawImage(watermarkImage, x, y, watermarkWidth, watermarkHeight);
            ctx.globalAlpha = 1;
        }
        
        function sharpenImage(imageData, factor) {
            // Simple sharpening filter using convolution
            const width = imageData.width;
            const height = imageData.height;
            const data = imageData.data;
            const output = new Uint8ClampedArray(data);
            
            // Sharpening kernel
            const kernel = [
                0, -1, 0,
                -1, 5, -1,
                0, -1, 0
            ];
            
            const kernelSize = 3;
            const half = Math.floor(kernelSize / 2);
            
            for (let y = half; y < height - half; y++) {
                for (let x = half; x < width - half; x++) {
                    for (let c = 0; c < 3; c++) { // RGB channels only
                        let sum = 0;
                        for (let ky = -half; ky <= half; ky++) {
                            for (let kx = -half; kx <= half; kx++) {
                                const idx = ((y + ky) * width + (x + kx)) * 4 + c;
                                const kernelIdx = (ky + half) * kernelSize + (kx + half);
                                sum += data[idx] * kernel[kernelIdx];
                            }
                        }
                        
                        const outputIdx = (y * width + x) * 4 + c;
                        output[outputIdx] = Math.max(0, Math.min(255, data[outputIdx] + factor * sum));
                    }
                }
            }
            
            return new ImageData(output, width, height);
        }
        
        function downloadImage() {
            if (!currentImage) {
                alert('Please upload and process an image first.');
                return;
            }
            
            const link = document.createElement('a');
            link.download = 'watermarked-image.jpg';
            link.href = currentImage.src;
            link.click();
        }
        
        // Initialize with some default values
        window.addEventListener('DOMContentLoaded', () => {
            // Set initial values for display
            textSizeValue.textContent = `${textSize.value}px`;
            textColorValue.textContent = textColor.value.toUpperCase();
            textOpacityValue.textContent = `${textOpacity.value}%`;
            qualityValue.textContent = `${qualitySlider.value}%`;
            watermarkSizeValue.textContent = `${watermarkSize.value}%`;
            watermarkOpacityValue.textContent = `${watermarkOpacity.value}%`;
        });
    </script>
</body>
</html>
